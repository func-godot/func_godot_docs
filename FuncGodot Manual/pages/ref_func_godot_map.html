<!DOCTYPE html>
<html lang="en-US">
<head>
    <title>FuncGodot Manual</title>
    <link rel="icon" type="image/x-icon" href="../images/godot_ranger.svg">
    <link rel="stylesheet" href="styles.css">
</head>
<body class="main">
    <div class="main">
        <h1>FuncGodotMap</h1>
        <p><img src="../images/ref_func_godot_map.png"></p>
        <p>
            A scene generator node that parses a Quake MAP or Hammer VMF file using a <a href="ref_fgd_resources.html#File" target="main">FuncGodotFGDFile</a>. 
            Uses a <a href="#MapSettings">FuncGodotMapSettings</a> resource to define map build settings. 
        </p>

        <h3>Signals</h3>
        <table class="props">
            <tr class="header">
                <td>Signal</td>
                <td>Description</td>
            </tr>
            <tr>
                <td>build_failed</td>
                <td>Emitted when the build process fails.</td>
            </tr>
            <tr>
                <td>build_complete</td>
                <td>Emitted when the build process succesfully completes.</td>
            </tr>
        </table>
        
        <h3>Methods</h3>
        <table class="props">
            <tr class="header">
                <td>Method</td>
                <td>Description</td>
                <td>Return type</td>
            </tr>
            <tr>
                <td>fail_build(reason: String, notify: bool = false)</td>
                <td>Map build failure handler. Displays error message and emits <i>build_failed<i> signal.</i></td>
                <td>Void</td>
            </tr>
            <tr>
                <td>clear_children()</td>
                <td>Frees all children of the map node. WARNING! Does not distinguish between generated and placed nodes!</td>
                <td>Void</td>
            </tr>
            <tr>
                <td>verify()</td>
                <td>Validates the map file for the build process.</td>
                <td>Bool</td>
            </tr>
            <tr>
                <td>build()</td>
                <td>Cleans the map node of any children, then initiates and oversees the build process.</td>
                <td>Void</td>
            </tr>
        </table>

        <h3>Properties</h3>
        <table class="props">
            <tr class="header">
                <td>Property</td>
                <td>Type</td>
                <td>Description</td>
            </tr>
            <tr class="header"><td>Map</td><td></td><td></td></tr>
            <tr>
                <td>Local Map File</td>
                <td>String, Local File, .map, .vmf</td>
                <td>Local path to MAP or VMF file to build a scene from.</td>
            </tr>
            <tr>
                <td>Global Map File</td>
                <td>String, Global File, .map, .vmf</td>
                <td>Global path to MAP or VMF file to build a scene from. Overrides <i>Local Map File</i>.</td>
            </tr>
            <tr>
                <td>Map Settings</td>
                <td><a href="#MapSettings">FuncGodotFGDMapSettings</a></td>
                <td>Map settings resource that defines map build scale, textures location, and more.</td>
            </tr>
            
            <tr class="header"><td>Build</td><td></td><td></td></tr>
            <tr>
                <td>Build Flags</td>
                <td>Int</td>
                <td>
                    Bitflag settings that control various aspects of the build process.<br>
                    <ul>
                        <li><b>Unwrap UV2 :</b> Unwrap UV2s during geometry generation for lightmap baking.</li>
                        <li><b>Show Profiling Info :</b> Print build step information during build process.</li>
                        <li><b>Disable Smoothing :</b> Force disable processing of vertex normal smooth shading.</li>
                    </ul>
                </td>
            </tr>
        </table>

        <br><hr>

        <h2 id="MapSettings">FuncGodotMapSettings</h2>
        <p><img src="../images/ref_func_godot_map_settings.png"></p>
        <p>Reusable map settings configuration for <i>FuncGodotMap</i> nodes.</p><br>
        <table class="props">
            <tr class="header">
                <td>Property</td>
                <td>Type</td>
                <td>Description</td>
            </tr>
            <tr class="header"><td>Build Settings</td><td></td><td></td></tr>
            <tr>
                <td>Inverse Scale Factor</td>
                <td>Float</td>
                <td>
                    Ratio between map editor units and Godot units. FuncGodot will divide brush coordinates by this number when building. 
                    This does not affect entity properties unless scripted to do so.<br>
                    See <a href="guide_building_maps.html#InverseScaleFactor" target="main">Inverse Scale Factor</a> for more information.
                </td>
            </tr>
            <tr>
                <td>Entity Fgd</td>
                <td><a href="ref_fgd_resources.html#File" target="main">FuncGodotFGDFile</a></td>
                <td>Resource file that translates map file classnames into Godot nodes and packed scenes.</td>
            </tr>
            <tr>
                <td>Entity Name Property</td>
                <td>String</td>
                <td>
                    Default class property to use in naming generated nodes. This setting is overridden by <code>name_property</code> in 
                    <a href="ref_fgd_resources.html#Entity" target="main">FuncGodotFGDEntityClass</a>. 
                    Naming occurs before adding to the <i>SceneTree</i> and applying properties. 
                    Nodes will be named <code>"entity_" + name_property</code>.<br><br>
                    <i>NOTE: Node names should be unique, otherwise you may run into unexpected behavior!</i>
                </td>
            </tr>
            <tr>
                <td>Entity Smoothing Property</td>
                <td>String</td>
                <td>Class property that determines whether the Solid Entity performs mesh smoothing operations.</td>
            </tr>
            <tr>
                <td>Entity Smoothing Angle Property</td>
                <td>String</td>
                <td>Class property that contains the angular threshold that determines when a Solid Entity's mesh vertices are smoothed.</td>
            </tr>
            <tr>
                <td>Use Groups Hierarchy</td>
                <td>Bool</td>
                <td>
                    If true, will organize Scene Tree using TrenchBroom Layers and Groups or Hammer Visgroups. Groups will be generated as [Node3D] nodes. 
                    All non-entity structural brushes will be moved out of their groups and merged into the Worldspawn entity.
                    Any Layers toggled to be omitted from export in TrenchBroom and their child entities and groups will not be built.
                </td>
            </tr>

            <tr class="header"><td>Textures</td><td></td><td></td></tr>
            <tr>
                <td>Base Texture Dir</td>
                <td>String</td>
                <td>
                    Base directory for textures. When building materials, FuncGodot will search this directory for texture files with matching names 
                    to the textures assigned to map brush faces.
                </td>
            </tr>
            <tr>
                <td>Texture File Extensions</td>
                <td>Array</td>
                <td>File extensions to search for texture data.</td>
            </tr>
            <tr>
                <td>Clip Texture</td>
                <td>String</td>
                <td>
                    Optional path for the clip texture, relative to <i>Base Texture Dir</i>. Brush faces textured with the clip texture will have those faces 
                    removed from the generated <i>Mesh</i> but not the generated <i>Shape3D</i>.
                </td>
            </tr>
            <tr>
                <td>Skip Texture</td>
                <td>String</td>
                <td>
                    Optional path for the skip texture, relative to <i>Base Texture Dir</i>. Brush faces textured with the skip texture will have those faces 
                    removed from the generated <i>Mesh</i>. If the <a href="ref_fgd_resources.html#Solid">FuncGodotFGDSolidClass</a> <i>collision_shape_type</i> 
                    is set to concave then it will also remove collision from those faces in the generated <i>Shape3D</i>.
                </td>
            </tr>
            <tr>
                <td>Origin Texture</td>
                <td>String</td>
                <td>
                    Optional path for the origin texture, relative to <i>Base Texture Dir</i>. Brush faces textured with the origin texture will have those faces 
                    removed from the generated <i>Mesh</i> and <i>Shape3D</i>. The bounds of these faces will be used to calculate the origin point of the entity.
                </td>
            </tr>
            <tr>
                <td>Texture Wads</td>
                <td>Array[Resource]</td>
                <td>
                    Optional <i>QuakeWADFile</i> resources to apply textures from. See the <a href="https://quakewiki.org/wiki/Texture_Wad" target="_blank">Quake Wiki</a> 
                    for more information on Quake Texture WADs. 
                    Supports both Quake WAD2 and Half-Life WAD3 formats.
                </td>
            </tr>

            <tr class="header"><td>Materials</td><td></td><td></td></tr>
            <tr>
                <td>Material File Extension</td>
                <td>String</td>
                <td>File extension to search for <i>Material</i> definitions.</td>
            </tr>
            <tr>
                <td>Base Material Dir</td>
                <td>String</td>
                <td>
                    Base directory for loading and saving materials. When building materials, FuncGodot will search this directory for material resources 
                    with matching names to the textures assigned to map brush faces. If not found, will fall back to <i>Base Texture Dir</i>.
                </td>
            </tr>
            <tr>
                <td>Default Material</td>
                <td>Material</td>
                <td>Material used as a template when generating missing materials.</td>
            </tr>
            <tr>
                <td>Default Material Albedo Uniform</td>
                <td>String</td>
                <td>
                    <a href="https://docs.godotengine.org/en/stable/tutorials/shaders/shader_reference/shading_language.html#data-types" target="_blank">Sampler2D</a> 
                    uniform that supplies the Albedo in a custom shader when <i>Default Material</i> 
                    is a <a href="https://docs.godotengine.org/en/stable/classes/class_shadermaterial.html" target="_blank">ShaderMaterial</a>.
                </td>
            </tr>
            
            <tr>
                <td>Albedo Map Pattern</td>
                <td>String</td>
                <td>Automatic PBR material generation albedo map pattern.</td>
            </tr>
            <tr>
                <td>Normal Map Pattern</td>
                <td>String</td>
                <td>Automatic PBR material generation normal map pattern.</td>
            </tr>
            <tr>
                <td>Metallic Map Pattern</td>
                <td>String</td>
                <td>Automatic PBR material generation metallic map pattern.</td>
            </tr>
            <tr>
                <td>Roughness Map Pattern</td>
                <td>String</td>
                <td>Automatic PBR material generation roughness map pattern.</td>
            </tr>
            <tr>
                <td>Emission Map Pattern</td>
                <td>String</td>
                <td>Automatic PBR material generation emission map pattern.</td>
            </tr>
            <tr>
                <td>Ao Map Pattern</td>
                <td>String</td>
                <td>Automatic PBR material generation ambient occlusion map pattern.</td>
            </tr>
            <tr>
                <td>Height Map Pattern</td>
                <td>String</td>
                <td>Automatic PBR material generation height map pattern.</td>
            </tr>
            <tr>
                <td>Orm Map Pattern</td>
                <td>String</td>
                <td>Automatic PBR material generation ORM map pattern.</td>
            </tr>
            <tr>
                <td>Save Generated Materials</td>
                <td>Bool</td>
                <td>
                    Save automatically generated materials to disk, allowing reuse across <i>FuncGodotMap</i> nodes.<br> 
                    <i>NOTE: Materials do not use the Default Material settings after saving.</i>
                </td>
            </tr>

            <tr class="header"><td>UV Unwrap</td><td></td><td></td></tr>
            <tr>
                <td>Uv Unwrap Texel Size</td>
                <td>Float</td>
                <td>
                    Texel size for UV2 unwrapping. Actual texel size is uv_unwrap_texel_size / inverse_scale_factor. 
                    A ratio of 1/16 is usually a good place to start with (if inverse_scale_factor is 32, start with a uv_unwrap_texel_size of 2). 
                    Larger values will produce less detailed lightmaps. To conserve memory and filesize, use the largest value that still looks good.
                </td>
            </tr>
        </table>
    </div>
    <br><br><br>
</body>
</html>